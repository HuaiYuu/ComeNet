@{
	var id = ViewBag.id;
	ViewData["Title"] = "Friend";
}
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" />
<head>
	
	
	<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
	<link rel="stylesheet" href="~/ComeNet.styles.css" asp-append-version="true" />
</head>
<section id="team" class="team_area section-padding">
		<div class="container">
		<div id="pagination"></div>
			<h2 class="title_spectial">好友列表</h2>
			<div class="row text-center space" id="team-members">
			</div>
		</div>
	</section>
<style>

	

	.videochat{

	}
	
	.space
	{
		
		justify-content: space-around;
	}

	
a{
text-decoration:none;
}

.team_area{
	background:#fbfafa;
}
.team_title {
    color: #000;
	margin-bottom: 60px;
	text-align: center;
	text-transform: capitalize;
	font-weight: 600;
}
.our-team {}
@@media only screen and (max-width:768px) 
{ 
.our-team {margin-bottom:30px}
}
.single-team{margin-bottom:10px;}
.single-team img {
	margin-bottom:15px;
	border-radius:2px;
	border: 10px solid #fff;
}
.single-team h3 {
	margin-bottom:0px;
	font-size:18px;
	font-weight: 600;
}
.single-team p{margin-bottom:0px;}

.our-team .social {
	list-style: none;
	padding: 0;
	margin: 0;
	text-align: center;
	-webkit-transition: all 0.3s ease 0s;
	transition: all 0.3s ease 0s;
}
.our-team .social li{
display: inline-block;
}
.our-team .social li a {
	display: block;
	width: 35px;
	height: 35px;
	line-height: 35px;
	font-size: 15px;
	color: #fff;
	position: relative;
	-webkit-transition: all 0.3s ease-in-out 0s;
	transition: all 0.3s ease-in-out 0s;
	border-radius: 30px;
	margin: 3px;
}
.our-team:hover .social li:nth-child(1) a{
    -webkit-transition-delay: 0.3s;
            transition-delay: 0.3s;
}
.our-team:hover .social li:nth-child(2) a{
    -webkit-transition-delay: 0.2s;
            transition-delay: 0.2s
}
.our-team:hover .social li:nth-child(3) a{
    -webkit-transition-delay: 0.1s;
            transition-delay: 0.1s;
}
.our-team:hover .social li:nth-child(4) a{
    -webkit-transition-delay: 0s;
            transition-delay: 0s;
}
.our-team .social li a:hover{
    -webkit-transition-delay: 0s;
            transition-delay: 0s;
}

.facebook{background: #1C58A1;}
.facebook:hover{background: #fff;color:#1C58A1!important;}
.twitter{background: #0CBCE3;}
.twitter:hover{background: #fff;color:#0CBCE3!important;}
.google{background: #F04537;}
.google:hover{background: #fff;color:#F04537!important;}

/*START BOARD DIRECTOR*/
.bod_area {
	padding-bottom: 80px;
	background:#fbfafa;
}
.our-bod {}
@@media only screen and (max-width:768px) { 
.our-bod {margin-bottom:30px}
}
.single-bod{margin-bottom:10px;}
.single-bod img {
	margin-bottom:15px;
	width: 180px;
	border-radius:2px;
	height: 180px;
	border: 10px solid #fff;
}
.single-bod h3 {
	margin-bottom:0px;
	font-size:18px;
	font-weight: 600;
}
.single-bod p{margin-bottom:0px;}

.our-bod .social {
	list-style: none;
	padding: 0;
	margin: 0;
	text-align: center;
	-webkit-transition: all 0.3s ease 0s;
	transition: all 0.3s ease 0s;
}
.our-bod .social li{
display: inline-block;
}
.our-bod .social li a {
	display: block;
	width: 35px;
	height: 35px;
	line-height: 35px;
	font-size: 15px;
	color: #fff;
	position: relative;
	-webkit-transition: all 0.3s ease-in-out 0s;
	transition: all 0.3s ease-in-out 0s;
	border-radius: 30px;
	margin: 3px;
}
.our-bod:hover .social li:nth-child(1) a{
    -webkit-transition-delay: 0.3s;
            transition-delay: 0.3s;
}
.our-bod:hover .social li:nth-child(2) a{
    -webkit-transition-delay: 0.2s;
            transition-delay: 0.2s
}
.our-bod:hover .social li:nth-child(3) a{
    -webkit-transition-delay: 0.1s;
            transition-delay: 0.1s;
}
.our-bod:hover .social li:nth-child(4) a{
    -webkit-transition-delay: 0s;
            transition-delay: 0s;
}
.our-bod .social li a:hover{
    -webkit-transition-delay: 0s;
            transition-delay: 0s;
}
.title_spectial {
    text-align: center;
    font-weight: 600;
    position: relative;
    margin-bottom: 60px;
    text-transform: uppercase;
    font-size: 24px;
}
.bod_area {
    padding-bottom: 80px;
}

.section-padding {
    padding: 80px 0;
    padding-top: 100px;
}

	.camera{
		color: white !important;
		background-color:black;
	}

	.chat
	{
		color: white !important;
		background-color: red;
	}
	.phone{
		color: white !important;
		background-color: aqua;

	}
	.distance{
		margin-left: 20%;
		color: orange;
		display: flex;
	}
</style>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

<script>

	toastr.options = {
		"closeButton": false,
		"debug": true,
		"newestOnTop": false,
		"progressBar": false,
		"positionClass": "toast-top-center",
		"preventDuplicates": false,
		"showDuration": "300",
		"hideDuration": "1000",
		"timeOut": "5000",
		"extendedTimeOut": "1000",
		"showEasing": "swing",
		"hideEasing": "linear",
		"showMethod": "fadeIn",
		"hideMethod": "fadeOut"

	}

	


	function ready() {

	}
	document.addEventListener("DOMContentLoaded", ready);

	var currentPage = 1; 
	var itemsPerPage = 4; 
	function fetchData()
	{
		var myHeaders = new Headers();
		myHeaders.append("Content-Type", "application/json");

		var raw = JSON.stringify({
			"userid": @id,
		});

		var requestOptions = {
			method: 'POST',
			headers: myHeaders,
			body: raw,
			redirect: 'follow'
		};

		fetch("https://johnny666.online/api/users/friendlist", requestOptions)
			.then(response => response.json())
			.then(data => {

				updatePagination(data);

				const teamMembersContainer = document.getElementById('team-members');
				teamMembersContainer.innerHTML = ''; 
				const startIndex = (currentPage - 1) * itemsPerPage;
				console.log(startIndex);
				const endIndex = startIndex + itemsPerPage;
				console.log(endIndex);
				const currentPageData = data.slice(startIndex, endIndex);
				console.log(currentPageData);

				currentPageData.forEach(member => {
					const memberHtml = `
							<div class="col-lg-2 col-sm-4 col-xs-12 wow fadeInUp" data-wow-duration="1s" data-wow-delay="0.1s" data-wow-offset="0">
								<div class="our-team">
									<div class="single-team">
										    <img style="height:112.45px;width:112.45px;" src="${member.picture}" class="img-fluid" alt="${member.name}">
											<h3>${member.name}</h3>
											<h4>${member.id}</h4>
											<div class="distance">
									    	  <i class="fa fa-map-marker"></i>
											  <p>距離:${member.distance}公里</p>
											</div>
									</div>
										<ul class="social">
												<li><a id="videochatbtn"  data-userid="${member.id}"  class="fa fa-video-camera fa-2x camera "></a></li>
											    <li><a id="phone"  data-userid="${member.id}"class="fa fa-phone fa-2x phone"></a></li>
												<li><a id="chat" data-userid="${member.id}" class="fa fa-commenting fa-2x chat"></a></li>
									    </ul>
								</div>
							</div>`;

					
					teamMembersContainer.innerHTML += memberHtml;
				});
				
			})
			.catch(error => {
				console.error('Error fetching team member data:', error);
			});
	}
	function sentvideorequest(memberId) 
	{
		console.log(userId);
		console.log(memberId);

		var time = new Date();
		var formattedDateTime = time.toLocaleString();
		console.log(formattedDateTime);
		var roomId = null;

		var myHeaders = new Headers();
		myHeaders.append("Content-Type", "application/json");

		var chatmember = JSON.stringify(
			{
				"chater1": userId.toString(),
				"chater2": memberId.toString(),
				"chater": userId.toString(),
			});
		var requestroomid =
		{
			method: 'POST',
			headers: myHeaders,
			body: chatmember,
			redirect: 'follow'
		};

		fetch("https://johnny666.online/api/users/CreateChatRoom", requestroomid)
			.then(response => response.json())
			.then(result => {

				if (result.message != null) 
				{
					roomId = result.message;
					console.log(roomId);

					window.location.href = 'https://johnny666.online/VideoRoom/' + roomId;

					var rawvideo = JSON.stringify({
						"articleHeading": formattedDateTime + "您有新訊息",
						"articleContent": "https://johnny666.online/VideoRoom/" + roomId,
						"userId": memberId,
					});
					var requestvideo = {
						method: 'POST',
						headers: myHeaders,
						body: rawvideo,
						redirect: 'follow'
					};

					    fetch("https://johnny666.online/api/users/SendToSpecificUser", requestvideo)
						.then(response => response.json())
						.then(result => {
							if (result.message != null)
							{								
								if (result.message != "用戶不在線上")
								{
									toastr["success"](result.message);
									window.location.href = 'https://johnny666.online/VideoRoom/' + roomId;
								}
								else
								{
									toastr["error"](result.message);
									
								}
								
							}
							else 
							{
								alert('請稍等');
							}

						})
						.catch(error => console.log('error', error));


				}
				else 
				{
					alert('請稍等');
				}

			})
			.catch(error => console.log('error', error));
		   
	}
	function updatePagination(data)
	{
		const totalPages = Math.ceil(data.length / itemsPerPage);
		console.log(totalPages);
		const paginationContainer = document.getElementById('pagination');
		paginationContainer.innerHTML = ''; 

		for (let i = 1; i <= totalPages; i++) {
			const pageButton = document.createElement('button');
			pageButton.textContent = i;
			pageButton.addEventListener('click', () => 
			{
				currentPage = i; 
				console.log(currentPage);
				fetchData(); 
			});
			paginationContainer.appendChild(pageButton);
		}
	}
	fetchData(); 

	var time = new Date();
	var formattedDateTime = time.toLocaleString();

	console.log(formattedDateTime);
	var memberId = null;


	
	
	document.addEventListener('click', function (event)
	{
		if (event.target.id === 'videochatbtn') 
		{
			var memberId = event.target.getAttribute('data-userid');
			console.log('Member ID:', memberId);
			sentvideorequest(memberId)
		}
		if (event.target.id === 'phone') 
		{
			var memberId = event.target.getAttribute('data-userid');
			console.log('Member ID:', memberId);
			sentvideorequest(memberId)
		}
	});




  //  document.addEventListener('click', function (event)
		//{
		//	if (event.target.id === 'videochat')
		//	{

		//		var h4Tags = document.querySelectorAll('a');
		//		h4Tags.forEach(function (h4Tag) {
		//			h4Tag.addEventListener('click', function () {
		//				memberId = h4Tag.getAttribute('data-userid');
		//				console.log('Member ID:', memberId);
						
		//			});
		//		});



		//		///////發送邀請api
		//		//var myHeaders = new Headers();
		//		//myHeaders.append("Content-Type", "application/json");
		//		//var rawvideo = JSON.stringify({
		//		//	"articleHeading": formattedDateTime + " 視訊邀請",
		//		//	"articleContent": "shttp://johnny666.online/18",
		//		//	"userId": memberId,
		//		//});
		//		//var requestvideo = {
		//		//	method: 'POST',
		//		//	headers: myHeaders,
		//		//	body: rawvideo,
		//		//	redirect: 'follow'
		//		//};

		//		//fetch("shttps://localhost:7136/api/users/SendToSpecificUser", requestvideo)
		//		//	.then(response => response.json())
		//		//	.then(result => {
		//		//		if (result.userId != null)
		//		//		{
		//		//			console.log(result.userId);
		//		//			window.open('shttps://localhost:7136/Home/startvideochat');
		//		//		}
		//		//		else
		//		//		{
		//		//			alert('請稍等');
		//		//			//window.location.reload();
		//		//		}

		//		//	})
		//		//	.catch(error => console.log('error', error));

		//	}
		//	if (event.target.id === 'chat')
		//	{



		//	}
		//});

    
	


</script>
